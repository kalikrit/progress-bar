import{q as Z,r as x,j as E,d as W,b as p,c as g,g as t,F as $,m as A,u as B,s as X,t as b,l as V,v as L,f as I,h as N,e as H,x as Y}from"./index-C7xtH_U3.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j=Z("pieChart",()=>{const i=x([{id:1,name:"Сектор-1",percentage:20,color:"#FF6384"},{id:2,name:"Сектор-2",percentage:20,color:"#36A2EB"},{id:3,name:"Сектор-3",percentage:20,color:"#FFCE56"}]),s=E(()=>i.value.reduce((r,l)=>r+l.percentage,0)),k=E(()=>100-s.value),F=E(()=>{let l=0;return i.value.map(c=>{let m=c.percentage/100*360;i.value.length===1&&c.percentage===100&&(m=359.9999);const u=l,_=l+m;return l=_,{...c,startAngle:u,endAngle:_,angle:m}})});return{sectors:i,totalPercentage:s,remainingPercentage:k,sectorsWithAngles:F,addSector:r=>{const l=Number(r.percentage),c=s.value;if(c+l>100)return{success:!1,message:`Сумма процентов не может превышать 100%. Доступно: ${100-c}%`};const m=i.value.length>0?Math.max(...i.value.map(u=>u.id))+1:1;return i.value.push({id:m,name:r.name||`Сектор-${m}`,percentage:l,color:r.color||"#FF6384"}),{success:!0}},updateSector:(r,l)=>{const c=i.value.find(a=>a.id===r);if(!c)return{success:!1,message:"Сектор не найден"};const m=s.value,u=c.percentage,_=l.percentage!==void 0?Number(l.percentage):u;if(m-u+_>100)return{success:!1,message:`Сумма процентов не может превышать 100%. Максимум для этого сектора: ${100-(m-u)}%`};const S=i.value.indexOf(c),T={id:c.id,name:l.name!==void 0?l.name:c.name,percentage:_,color:l.color!==void 0?l.color:c.color};return i.value.length===1&&_===100?(i.value[S]={...T,percentage:99.999},setTimeout(()=>{i.value[S]=T},10)):i.value[S]=T,{success:!0}},deleteSector:r=>{i.value=i.value.filter(l=>l.id!==r)},getSectorById:r=>i.value.find(l=>l.id===r),canAddSector:r=>s.value+r<=100,canUpdateSector:(r,l)=>{const c=i.value.find(u=>u.id===r);return c?s.value-c.percentage+l<=100:!1},getMaxPercentageForNewSector:()=>100-s.value,getMaxPercentageForSector:r=>{const l=i.value.find(c=>c.id===r);return l?100-(s.value-l.percentage):0},getSectorPath:r=>{const u=(r.startAngle-90)*Math.PI/180,_=(r.endAngle-90)*Math.PI/180,M=250+200*Math.cos(u),S=250+200*Math.sin(u),T=250+200*Math.cos(_),a=250+200*Math.sin(_),n=r.angle>180?1:0;return["M 250 250",`L ${M} ${S}`,`A 200 200 0 ${n} 1 ${T} ${a}`,"Z"].join(" ")}}}),z={class:"pie-chart-container"},R={class:"content-wrapper"},q={class:"left-column"},O={class:"sectors-list"},G={class:"sector-left"},J={class:"sector-name"},K={class:"sector-percentage"},Q={class:"sector-right"},ee=["onClick"],te=["onClick"],ne={class:"right-column"},oe={class:"chart-wrapper"},ae={class:"pie-chart",viewBox:"0 0 500 500"},le=["d","fill"],se={class:"sector-names"},re={class:"add-sector-modal"},ce={class:"modal-header"},ie={class:"modal-title"},de={class:"modal-form"},ue={class:"form-field"},ve={key:0,class:"error-message"},me={class:"form-field"},pe={class:"value-input-container"},ge=["max"],fe={key:0,class:"error-message"},he={class:"form-field"},_e={class:"color-picker-container"},Fe={class:"color-palette"},Ce=["onClick"],we={class:"color-input-row"},Se={class:"color-picker-wrapper"},xe=["disabled"],Te=W({__name:"PieChartView",setup(i){const s=j(),k=x(!1),F=x("add"),f=x(null),h=x("");let C=null;const v=x("");let w=null;const U=()=>{if(w&&clearTimeout(w),o.name.trim()===""){v.value="Название сектора не может быть пустым";return}w=setTimeout(()=>{const a=o.name.trim();a===""?v.value="Название сектора не может быть пустым":a.length<2?v.value="Название должно содержать минимум 2 символа":v.value=""},2e3)},o=Y({id:null,name:"",percentage:"",color:"#FF6384"}),y=x(["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF","#4BC0C0","#9966FF","#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"]),P=x(0),r=()=>{const a=s.sectors.reduce((n,e)=>n+e.percentage,0);if(F.value==="add")return 100-a;if(f.value!==null){const n=s.sectors.find(e=>e.id===f.value);if(n)return 100-(a-n.percentage)}return 100},l=()=>{C&&clearTimeout(C),C=setTimeout(()=>{const a=Number(o.percentage),n=s.sectors.reduce((e,d)=>e+d.percentage,0);if(F.value==="add")n+a>100?h.value=`Сумма превысит 100%! Доступно: ${100-n}%`:h.value="";else if(f.value!==null){const e=s.sectors.find(d=>d.id===f.value);e&&(n-e.percentage+a>100?h.value=`Сумма превысит 100%! Максимум: ${100-(n-e.percentage)}%`:h.value="")}},1500)},c=E(()=>{const a=Number(o.percentage),n=s.sectors.reduce((e,d)=>e+d.percentage,0);if(F.value==="add"){if(n+a>100)return!1}else if(f.value!==null){const e=s.sectors.find(d=>d.id===f.value);if(e&&n-e.percentage+a>100)return!1}return o.name.trim()!==""&&a>=1&&a<=100&&h.value===""&&v.value===""}),m=()=>{F.value="add",S(),h.value="",v.value="",C&&clearTimeout(C),w&&clearTimeout(w),setTimeout(()=>{o.name.trim()===""&&(v.value="Название сектора не может быть пустым")},100),o.color=y.value[P.value]??"#FF6384",P.value=(P.value+1)%y.value.length,k.value=!0},u=a=>{F.value="edit",f.value=a.id,h.value="",v.value="",C&&clearTimeout(C),w&&clearTimeout(w),o.id=a.id,o.name=a.name,o.percentage=a.percentage,o.color=a.color,k.value=!0},_=()=>{if(!c.value)return;const a=Number(o.percentage),n=s.sectors.reduce((e,d)=>e+d.percentage,0);if(F.value==="add"){if(n+a>100){alert(`Сумма процентов не может превышать 100%. Доступно: ${100-n}%`);return}s.addSector({name:o.name,percentage:a,color:o.color})}else if(f.value!==null){const e=s.sectors.find(d=>d.id===f.value);if(e&&n-e.percentage+a>100){alert(`Сумма процентов не может превышать 100%. Максимум: ${100-(n-e.percentage)}%`);return}s.updateSector(f.value,{name:o.name,percentage:a,color:o.color})}M()},M=()=>{k.value=!1,f.value=null,S(),h.value="",v.value="",C&&clearTimeout(C),w&&clearTimeout(w)},S=()=>{o.id=null,o.name="",o.percentage="",o.color="#FF6384"},T=a=>{s.deleteSector(a)};return(a,n)=>(p(),g("div",z,[n[9]||(n[9]=t("header",{class:"header"},[t("h1",{class:"title"},"Круговая диаграмма")],-1)),t("div",R,[t("div",q,[t("div",O,[(p(!0),g($,null,A(B(s).sectors,e=>(p(),g("div",{key:e.id,class:"sector-row"},[t("div",G,[t("span",J,b(e.name),1),n[4]||(n[4]=t("div",{class:"vertical-divider"},null,-1)),t("span",K,b(e.percentage)+"%",1),n[5]||(n[5]=t("div",{class:"vertical-divider"},null,-1)),t("div",{class:"color-circle",style:H({backgroundColor:e.color})},null,4)]),t("div",Q,[t("button",{onClick:d=>u(e),class:"icon-btn edit-btn",title:"Редактировать"},[...n[6]||(n[6]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M14.06 9.02L14.98 9.94L5.92 19H5V18.08L14.06 9.02ZM17.66 3C17.41 3 17.15 3.1 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C18.17 3.09 17.92 3 17.66 3ZM14.06 6.19L3 17.25V21H6.75L17.81 9.94L14.06 6.19Z",fill:"#666"})],-1)])],8,ee),t("button",{onClick:d=>T(e.id),class:"icon-btn delete-btn",title:"Удалить"},[...n[7]||(n[7]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z",fill:"#666"})],-1)])],8,te)])]))),128))]),t("button",{onClick:m,class:"add-sector-btn"},[...n[8]||(n[8]=[t("span",{class:"btn-text"},"Добавить сектор",-1)])])]),t("div",ne,[t("div",oe,[(p(),g("svg",ae,[(p(!0),g($,null,A(B(s).sectorsWithAngles,e=>(p(),g("g",{key:"slice-"+e.id},[t("path",{d:B(s).getSectorPath(e),fill:e.color,stroke:"#FFFFFF","stroke-width":"2",class:"sector-path"},null,8,le)]))),128))]))]),t("div",se,[(p(!0),g($,null,A(B(s).sectors,e=>(p(),g("div",{key:"label-"+e.id,class:"sector-label"},b(e.name),1))),128))])])]),k.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:X(M,["self"])},[t("div",re,[t("div",ce,[t("h2",ie,b(F.value==="add"?"Добавление сектора":"Редактирование сектора"),1)]),t("div",de,[t("div",ue,[V(t("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>o.name=e),type:"text",class:I(["name-input",{"error-input":v.value}]),placeholder:"Наименование",onInput:U},null,34),[[L,o.name]]),v.value?(p(),g("div",ve,b(v.value),1)):N("",!0)]),t("div",me,[t("div",pe,[V(t("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>o.percentage=e),type:"number",class:I(["value-input",{"error-input":h.value}]),min:1,max:r(),placeholder:"Значение",onInput:l},null,42,ge),[[L,o.percentage,void 0,{number:!0}]]),h.value?(p(),g("div",fe,b(h.value),1)):N("",!0)])]),t("div",he,[t("div",_e,[t("div",Fe,[(p(!0),g($,null,A(y.value,e=>(p(),g("div",{key:e,class:I(["color-option",{active:o.color===e}]),style:H({backgroundColor:e}),onClick:d=>o.color=e},null,14,Ce))),128))]),t("div",we,[V(t("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>o.color=e),type:"text",class:"hex-input",placeholder:"Цвет"},null,512),[[L,o.color]]),t("div",Se,[t("div",{class:"selected-color-preview",style:H({backgroundColor:o.color})},null,4),V(t("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>o.color=e),type:"color",class:"native-color-input",title:"Выберите цвет"},null,512),[[L,o.color]])])])])]),t("button",{onClick:_,class:"modal-add-btn",disabled:!c.value},b(F.value==="add"?"Добавить сектор":"Редактировать сектор"),9,xe)])])])):N("",!0)]))}}),Me=D(Te,[["__scopeId","data-v-dcc76007"]]);export{Me as default};
