import{q as H,r as f,j as x,d as N,b as d,c as u,g as o,F as _,m as F,u as C,s as I,t as m,l as S,v as w,e as P,h as U,x as Z,f as X}from"./index-jHFzjC8l.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j=H("pieChart",()=>{const i=f([{id:1,name:"Сектор-1",percentage:20,color:"#FF6384"},{id:2,name:"Сектор-2",percentage:20,color:"#36A2EB"},{id:3,name:"Сектор-3",percentage:20,color:"#FFCE56"}]),l=x(()=>i.value.reduce((a,r)=>a+r.percentage,0)),g=x(()=>100-l.value),p=x(()=>{const a=l.value;let r=0;return i.value.map(n=>{const t=n.percentage/a*360,e=r,c=r+t;return r=c,{...n,startAngle:e,endAngle:c,angle:t}})});return{sectors:i,totalPercentage:l,remainingPercentage:g,sectorsWithAngles:p,addSector:a=>{const r=Number(a.percentage),n=l.value;if(n+r>100)return{success:!1,message:`Сумма процентов не может превышать 100%. Доступно: ${100-n}%`};const t=i.value.length>0?Math.max(...i.value.map(e=>e.id))+1:1;return i.value.push({id:t,name:a.name||`Сектор-${t}`,percentage:r,color:a.color||"#FF6384"}),{success:!0}},updateSector:(a,r)=>{const n=i.value.find(h=>h.id===a);if(!n)return{success:!1,message:"Сектор не найден"};const t=l.value,e=n.percentage,c=r.percentage!==void 0?Number(r.percentage):e;if(t-e+c>100)return{success:!1,message:`Сумма процентов не может превышать 100%. Максимум для этого сектора: ${100-(t-e)}%`};const k=i.value.indexOf(n),y={id:n.id,name:r.name!==void 0?r.name:n.name,percentage:c,color:r.color!==void 0?r.color:n.color};return i.value[k]=y,{success:!0}},deleteSector:a=>{i.value=i.value.filter(r=>r.id!==a)},getSectorById:a=>i.value.find(r=>r.id===a),canAddSector:a=>l.value+a<=100,canUpdateSector:(a,r)=>{const n=i.value.find(e=>e.id===a);return n?l.value-n.percentage+r<=100:!1},getMaxPercentageForNewSector:()=>100-l.value,getMaxPercentageForSector:a=>{const r=i.value.find(n=>n.id===a);return r?100-(l.value-r.percentage):0},getSectorPath:a=>{const e=(a.startAngle-90)*Math.PI/180,c=(a.endAngle-90)*Math.PI/180,T=250+200*Math.cos(e),k=250+200*Math.sin(e),y=250+200*Math.cos(c),h=250+200*Math.sin(c),E=a.angle>180?1:0;return["M 250 250",`L ${T} ${k}`,`A 200 200 0 ${E} 1 ${y} ${h}`,"Z"].join(" ")}}}),z={class:"pie-chart-container"},R={class:"content-wrapper"},W={class:"left-column"},q={class:"sectors-list"},D={class:"sector-left"},O={class:"sector-name"},G={class:"sector-percentage"},J={class:"sector-right"},K=["onClick"],Q=["onClick"],ee={class:"right-column"},te={class:"chart-wrapper"},oe={class:"pie-chart",viewBox:"0 0 500 500"},ne=["d","fill"],se={class:"sector-names"},re={class:"add-sector-modal"},ae={class:"modal-header"},le={class:"modal-title"},ce={class:"modal-form"},ie={class:"form-field"},de={class:"form-field"},ue={class:"value-input-container"},ve=["max"],pe={class:"form-field"},ge={class:"color-picker-container"},me={class:"color-palette"},fe=["onClick"],he={class:"color-input-row"},_e={class:"color-picker-wrapper"},Fe=["disabled"],Ce=N({__name:"PieChartView",setup(i){const l=j(),g=f(!1),p=f("add"),v=f(null),s=Z({id:null,name:"",percentage:"",color:"#FF6384"}),A=f(["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF","#4BC0C0","#9966FF","#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"]),B=()=>{const n=l.sectors.reduce((t,e)=>t+e.percentage,0);if(p.value==="add")return 100-n;if(v.value!==null){const t=l.sectors.find(e=>e.id===v.value);if(t)return 100-(n-t.percentage)}return 100},b=x(()=>{const n=Number(s.percentage),t=l.sectors.reduce((e,c)=>e+c.percentage,0);if(p.value==="add"){if(t+n>100)return!1}else if(v.value!==null){const e=l.sectors.find(c=>c.id===v.value);if(e&&t-e.percentage+n>100)return!1}return s.name.trim()!==""&&n>=1&&n<=100}),$=()=>{p.value="add",a(),g.value=!0},V=n=>{p.value="edit",v.value=n.id,s.id=n.id,s.name=n.name,s.percentage=n.percentage,s.color=n.color,g.value=!0},L=()=>{if(!b.value)return;const n=Number(s.percentage),t=l.sectors.reduce((e,c)=>e+c.percentage,0);if(p.value==="add"){if(t+n>100){alert(`Сумма процентов не может превышать 100%. Доступно: ${100-t}%`);return}l.addSector({name:s.name,percentage:n,color:s.color})}else if(v.value!==null){const e=l.sectors.find(c=>c.id===v.value);if(e&&t-e.percentage+n>100){alert(`Сумма процентов не может превышать 100%. Максимум: ${100-(t-e.percentage)}%`);return}l.updateSector(v.value,{name:s.name,percentage:n,color:s.color})}M()},M=()=>{g.value=!1,v.value=null,a()},a=()=>{s.id=null,s.name="",s.percentage="",s.color="#FF6384"},r=n=>{l.deleteSector(n)};return(n,t)=>(d(),u("div",z,[t[9]||(t[9]=o("header",{class:"header"},[o("h1",{class:"title"},"Круговая диаграмма")],-1)),o("div",R,[o("div",W,[o("div",q,[(d(!0),u(_,null,F(C(l).sectors,e=>(d(),u("div",{key:e.id,class:"sector-row"},[o("div",D,[o("span",O,m(e.name),1),t[4]||(t[4]=o("div",{class:"vertical-divider"},null,-1)),o("span",G,m(e.percentage)+"%",1),t[5]||(t[5]=o("div",{class:"vertical-divider"},null,-1)),o("div",{class:"color-circle",style:P({backgroundColor:e.color})},null,4)]),o("div",J,[o("button",{onClick:c=>V(e),class:"icon-btn edit-btn",title:"Редактировать"},[...t[6]||(t[6]=[o("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[o("path",{d:"M14.06 9.02L14.98 9.94L5.92 19H5V18.08L14.06 9.02ZM17.66 3C17.41 3 17.15 3.1 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C18.17 3.09 17.92 3 17.66 3ZM14.06 6.19L3 17.25V21H6.75L17.81 9.94L14.06 6.19Z",fill:"#666"})],-1)])],8,K),o("button",{onClick:c=>r(e.id),class:"icon-btn delete-btn",title:"Удалить"},[...t[7]||(t[7]=[o("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[o("path",{d:"M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z",fill:"#666"})],-1)])],8,Q)])]))),128))]),o("button",{onClick:$,class:"add-sector-btn"},[...t[8]||(t[8]=[o("span",{class:"btn-text"},"Добавить сектор",-1)])])]),o("div",ee,[o("div",te,[(d(),u("svg",oe,[(d(!0),u(_,null,F(C(l).sectorsWithAngles,e=>(d(),u("g",{key:"slice-"+e.id},[o("path",{d:C(l).getSectorPath(e),fill:e.color,stroke:"#FFFFFF","stroke-width":"2",class:"sector-path"},null,8,ne)]))),128))]))]),o("div",se,[(d(!0),u(_,null,F(C(l).sectors,e=>(d(),u("div",{key:"label-"+e.id,class:"sector-label"},m(e.name),1))),128))])])]),g.value?(d(),u("div",{key:0,class:"modal-overlay",onClick:I(M,["self"])},[o("div",re,[o("div",ae,[o("h2",le,m(p.value==="add"?"Добавление сектора":"Редактирование сектора"),1)]),o("div",ce,[o("div",ie,[S(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.name=e),type:"text",class:"name-input",placeholder:"Наименование"},null,512),[[w,s.name]])]),o("div",de,[o("div",ue,[S(o("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.percentage=e),type:"number",class:"value-input",min:1,max:B(),placeholder:"Значение"},null,8,ve),[[w,s.percentage,void 0,{number:!0}]])])]),o("div",pe,[o("div",ge,[o("div",me,[(d(!0),u(_,null,F(A.value,e=>(d(),u("div",{key:e,class:X(["color-option",{active:s.color===e}]),style:P({backgroundColor:e}),onClick:c=>s.color=e},null,14,fe))),128))]),o("div",he,[S(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.color=e),type:"text",class:"hex-input",placeholder:"Цвет"},null,512),[[w,s.color]]),o("div",_e,[o("div",{class:"selected-color-preview",style:P({backgroundColor:s.color})},null,4),S(o("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.color=e),type:"color",class:"native-color-input",title:"Выберите цвет"},null,512),[[w,s.color]])])])])]),o("button",{onClick:L,class:"modal-add-btn",disabled:!b.value},m(p.value==="add"?"Добавить сектор":"Редактировать сектор"),9,Fe)])])])):U("",!0)]))}}),xe=Y(Ce,[["__scopeId","data-v-de8f8955"]]);export{xe as default};
