import{q as Z,r as S,j as E,d as W,b as m,c as p,g as t,F as $,m as A,u as B,s as X,t as x,l as V,v as L,f as I,h as N,e as H,x as Y}from"./index-D9KCSyLA.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j=Z("pieChart",()=>{const d=S([{id:1,name:"Сектор-1",percentage:20,color:"#FF6384"},{id:2,name:"Сектор-2",percentage:20,color:"#36A2EB"},{id:3,name:"Сектор-3",percentage:20,color:"#FFCE56"}]),s=E(()=>d.value.reduce((r,l)=>r+l.percentage,0)),b=E(()=>100-s.value),_=E(()=>{let l=0;return d.value.map(c=>{const h=c.percentage/100*360,u=l,w=l+h;return l=w,{...c,startAngle:u,endAngle:w,angle:h}})});return{sectors:d,totalPercentage:s,remainingPercentage:b,sectorsWithAngles:_,addSector:r=>{const l=Number(r.percentage),c=s.value;if(c+l>100)return{success:!1,message:`Сумма процентов не может превышать 100%. Доступно: ${100-c}%`};const h=d.value.length>0?Math.max(...d.value.map(u=>u.id))+1:1;return d.value.push({id:h,name:r.name||`Сектор-${h}`,percentage:l,color:r.color||"#FF6384"}),{success:!0}},updateSector:(r,l)=>{const c=d.value.find(a=>a.id===r);if(!c)return{success:!1,message:"Сектор не найден"};const h=s.value,u=c.percentage,w=l.percentage!==void 0?Number(l.percentage):u;if(h-u+w>100)return{success:!1,message:`Сумма процентов не может превышать 100%. Максимум для этого сектора: ${100-(h-u)}%`};const T=d.value.indexOf(c),M={id:c.id,name:l.name!==void 0?l.name:c.name,percentage:w,color:l.color!==void 0?l.color:c.color};return d.value[T]=M,{success:!0}},deleteSector:r=>{d.value=d.value.filter(l=>l.id!==r)},getSectorById:r=>d.value.find(l=>l.id===r),canAddSector:r=>s.value+r<=100,canUpdateSector:(r,l)=>{const c=d.value.find(u=>u.id===r);return c?s.value-c.percentage+l<=100:!1},getMaxPercentageForNewSector:()=>100-s.value,getMaxPercentageForSector:r=>{const l=d.value.find(c=>c.id===r);return l?100-(s.value-l.percentage):0},getSectorPath:r=>{const u=(r.startAngle-90)*Math.PI/180,w=(r.endAngle-90)*Math.PI/180,k=250+200*Math.cos(u),T=250+200*Math.sin(u),M=250+200*Math.cos(w),a=250+200*Math.sin(w),o=r.angle>180?1:0;return["M 250 250",`L ${k} ${T}`,`A 200 200 0 ${o} 1 ${M} ${a}`,"Z"].join(" ")}}}),z={class:"pie-chart-container"},R={class:"content-wrapper"},q={class:"left-column"},O={class:"sectors-list"},G={class:"sector-left"},J={class:"sector-name"},K={class:"sector-percentage"},Q={class:"sector-right"},ee=["onClick"],te=["onClick"],oe={class:"right-column"},ne={class:"chart-wrapper"},ae={class:"pie-chart",viewBox:"0 0 500 500"},le=["d","fill"],se={class:"sector-names"},re={class:"add-sector-modal"},ce={class:"modal-header"},ie={class:"modal-title"},de={class:"modal-form"},ue={class:"form-field"},ve={key:0,class:"error-message"},me={class:"form-field"},pe={class:"value-input-container"},ge=["max"],fe={key:0,class:"error-message"},he={class:"form-field"},_e={class:"color-picker-container"},Fe={class:"color-palette"},Ce=["onClick"],we={class:"color-input-row"},Se={class:"color-picker-wrapper"},xe=["disabled"],be=W({__name:"PieChartView",setup(d){const s=j(),b=S(!1),_=S("add"),g=S(null),f=S("");let F=null;const v=S("");let C=null;const U=()=>{if(C&&clearTimeout(C),n.name.trim()===""){v.value="Название сектора не может быть пустым";return}C=setTimeout(()=>{const a=n.name.trim();a===""?v.value="Название сектора не может быть пустым":a.length<2?v.value="Название должно содержать минимум 2 символа":v.value=""},2e3)},n=Y({id:null,name:"",percentage:"",color:"#FF6384"}),y=S(["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF","#4BC0C0","#9966FF","#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"]),P=S(0),r=()=>{const a=s.sectors.reduce((o,e)=>o+e.percentage,0);if(_.value==="add")return 100-a;if(g.value!==null){const o=s.sectors.find(e=>e.id===g.value);if(o)return 100-(a-o.percentage)}return 100},l=()=>{F&&clearTimeout(F),F=setTimeout(()=>{const a=Number(n.percentage),o=s.sectors.reduce((e,i)=>e+i.percentage,0);if(_.value==="add")o+a>100?f.value=`Сумма превысит 100%! Доступно: ${100-o}%`:f.value="";else if(g.value!==null){const e=s.sectors.find(i=>i.id===g.value);e&&(o-e.percentage+a>100?f.value=`Сумма превысит 100%! Максимум: ${100-(o-e.percentage)}%`:f.value="")}},1500)},c=E(()=>{const a=Number(n.percentage),o=s.sectors.reduce((e,i)=>e+i.percentage,0);if(_.value==="add"){if(o+a>100)return!1}else if(g.value!==null){const e=s.sectors.find(i=>i.id===g.value);if(e&&o-e.percentage+a>100)return!1}return n.name.trim()!==""&&a>=1&&a<=100&&f.value===""&&v.value===""}),h=()=>{_.value="add",T(),f.value="",v.value="",F&&clearTimeout(F),C&&clearTimeout(C),setTimeout(()=>{n.name.trim()===""&&(v.value="Название сектора не может быть пустым")},100),n.color=y.value[P.value]??"#FF6384",P.value=(P.value+1)%y.value.length,b.value=!0},u=a=>{_.value="edit",g.value=a.id,f.value="",v.value="",F&&clearTimeout(F),C&&clearTimeout(C),n.id=a.id,n.name=a.name,n.percentage=a.percentage,n.color=a.color,b.value=!0},w=()=>{if(!c.value)return;const a=Number(n.percentage),o=s.sectors.reduce((e,i)=>e+i.percentage,0);if(_.value==="add"){if(o+a>100){alert(`Сумма процентов не может превышать 100%. Доступно: ${100-o}%`);return}s.addSector({name:n.name,percentage:a,color:n.color})}else if(g.value!==null){const e=s.sectors.find(i=>i.id===g.value);if(e&&o-e.percentage+a>100){alert(`Сумма процентов не может превышать 100%. Максимум: ${100-(o-e.percentage)}%`);return}s.updateSector(g.value,{name:n.name,percentage:a,color:n.color})}k()},k=()=>{b.value=!1,g.value=null,T(),f.value="",v.value="",F&&clearTimeout(F),C&&clearTimeout(C)},T=()=>{n.id=null,n.name="",n.percentage="",n.color="#FF6384"},M=a=>{s.deleteSector(a)};return(a,o)=>(m(),p("div",z,[o[9]||(o[9]=t("header",{class:"header"},[t("h1",{class:"title"},"Круговая диаграмма")],-1)),t("div",R,[t("div",q,[t("div",O,[(m(!0),p($,null,A(B(s).sectors,e=>(m(),p("div",{key:e.id,class:"sector-row"},[t("div",G,[t("span",J,x(e.name),1),o[4]||(o[4]=t("div",{class:"vertical-divider"},null,-1)),t("span",K,x(e.percentage)+"%",1),o[5]||(o[5]=t("div",{class:"vertical-divider"},null,-1)),t("div",{class:"color-circle",style:H({backgroundColor:e.color})},null,4)]),t("div",Q,[t("button",{onClick:i=>u(e),class:"icon-btn edit-btn",title:"Редактировать"},[...o[6]||(o[6]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M14.06 9.02L14.98 9.94L5.92 19H5V18.08L14.06 9.02ZM17.66 3C17.41 3 17.15 3.1 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C18.17 3.09 17.92 3 17.66 3ZM14.06 6.19L3 17.25V21H6.75L17.81 9.94L14.06 6.19Z",fill:"#666"})],-1)])],8,ee),t("button",{onClick:i=>M(e.id),class:"icon-btn delete-btn",title:"Удалить"},[...o[7]||(o[7]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[t("path",{d:"M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z",fill:"#666"})],-1)])],8,te)])]))),128))]),t("button",{onClick:h,class:"add-sector-btn"},[...o[8]||(o[8]=[t("span",{class:"btn-text"},"Добавить сектор",-1)])])]),t("div",oe,[t("div",ne,[(m(),p("svg",ae,[(m(!0),p($,null,A(B(s).sectorsWithAngles,e=>(m(),p("g",{key:"slice-"+e.id},[t("path",{d:B(s).getSectorPath(e),fill:e.color,stroke:"#FFFFFF","stroke-width":"2",class:"sector-path"},null,8,le)]))),128))]))]),t("div",se,[(m(!0),p($,null,A(B(s).sectors,e=>(m(),p("div",{key:"label-"+e.id,class:"sector-label"},x(e.name),1))),128))])])]),b.value?(m(),p("div",{key:0,class:"modal-overlay",onClick:X(k,["self"])},[t("div",re,[t("div",ce,[t("h2",ie,x(_.value==="add"?"Добавление сектора":"Редактирование сектора"),1)]),t("div",de,[t("div",ue,[V(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>n.name=e),type:"text",class:I(["name-input",{"error-input":v.value}]),placeholder:"Наименование",onInput:U},null,34),[[L,n.name]]),v.value?(m(),p("div",ve,x(v.value),1)):N("",!0)]),t("div",me,[t("div",pe,[V(t("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>n.percentage=e),type:"number",class:I(["value-input",{"error-input":f.value}]),min:1,max:r(),placeholder:"Значение",onInput:l},null,42,ge),[[L,n.percentage,void 0,{number:!0}]]),f.value?(m(),p("div",fe,x(f.value),1)):N("",!0)])]),t("div",he,[t("div",_e,[t("div",Fe,[(m(!0),p($,null,A(y.value,e=>(m(),p("div",{key:e,class:I(["color-option",{active:n.color===e}]),style:H({backgroundColor:e}),onClick:i=>n.color=e},null,14,Ce))),128))]),t("div",we,[V(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>n.color=e),type:"text",class:"hex-input",placeholder:"Цвет"},null,512),[[L,n.color]]),t("div",Se,[t("div",{class:"selected-color-preview",style:H({backgroundColor:n.color})},null,4),V(t("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>n.color=e),type:"color",class:"native-color-input",title:"Выберите цвет"},null,512),[[L,n.color]])])])])]),t("button",{onClick:w,class:"modal-add-btn",disabled:!c.value},x(_.value==="add"?"Добавить сектор":"Редактировать сектор"),9,xe)])])])):N("",!0)]))}}),Me=D(be,[["__scopeId","data-v-159cf2cc"]]);export{Me as default};
